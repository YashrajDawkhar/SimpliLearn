import { Component, HostListener, Input, ViewEncapsulation } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
/**
 * Component for adding a go-to-top button to scrollable browser content
 */
export class NgGoTopButtonComponent {
    constructor() {
        this.animationState = 'out';
        this.timerID = null;
        /**
         * Go top button will appear when user scrolls Y to this position
         */
        this.scrollDistance = 200;
        /**
         * User styles config object
         */
        this.styles = {};
        /**
         * Classes to be applied to the button
         */
        this.classNames = 'go-top-button';
        /**
         * If true scrolling to top will be animated
         */
        this.animate = false;
        /**
         * Animated scrolling speed
         */
        this.speed = 80;
        /**
         * Acceleration coefficient, added to speed when using animated scroll
         */
        this.acceleration = 0;
        /**
         * Button tabIndex HTML attribute
         */
        this.tabIndex = 0;
    }
    ngOnInit() {
        this.validateInputs();
    }
    validateInputs() {
        const errorMessagePrefix = 'GoTopButton component input validation error: ';
        if (this.scrollDistance < 0) {
            throw Error(errorMessagePrefix + '\'scrollDistance\' parameter must be greater or equal to 0');
        }
        if (this.speed < 1) {
            throw Error(errorMessagePrefix + '\'speed\' parameter must be a positive number');
        }
        if (this.acceleration < 0) {
            throw Error(errorMessagePrefix + '\'acceleration\' parameter must be greater or equal to 0');
        }
        if (typeof this.classNames !== 'string') {
            throw Error(errorMessagePrefix + '\'classNames\' parameter must be a string like \'class1 class2 class3\'');
        }
    }
    /**
     * Listens to window scroll and animates the button
     */
    onWindowScroll() {
        if (this.isBrowser()) {
            this.animationState = this.getCurrentScrollTop() > this.scrollDistance ? 'in' : 'out';
        }
    }
    /**
     * Scrolls window to top
     */
    scrollTop(event) {
        if (!this.isBrowser()) {
            return;
        }
        event.preventDefault();
        if (this.animate) {
            this.animateScrollTop();
        }
        else {
            window.scrollTo(0, 0);
        }
    }
    /**
     * Performs the animated scroll to top
     */
    animateScrollTop() {
        if (this.timerID !== null) {
            return;
        }
        let initialSpeed = this.speed;
        this.timerID = setInterval(() => {
            window.scrollBy(0, -initialSpeed);
            initialSpeed = initialSpeed + this.acceleration;
            if (this.getCurrentScrollTop() === 0) {
                clearInterval(this.timerID);
                this.timerID = null;
            }
        }, 15);
    }
    /**
     * Get current Y scroll position
     */
    getCurrentScrollTop() {
        if (typeof window.scrollY !== 'undefined' && window.scrollY >= 0) {
            return window.scrollY;
        }
        if (typeof window.pageYOffset !== 'undefined' && window.pageYOffset >= 0) {
            return window.pageYOffset;
        }
        if (typeof document.body.scrollTop !== 'undefined' && document.body.scrollTop >= 0) {
            return document.body.scrollTop;
        }
        if (typeof document.documentElement.scrollTop !== 'undefined' && document.documentElement.scrollTop >= 0) {
            return document.documentElement.scrollTop;
        }
        return 0;
    }
    /**
     * Get button style
     */
    getStyle() {
        return this.styles || {};
    }
    /**
     * This check will prevent 'window' logic to be executed
     * while executing the server rendering
     */
    isBrowser() {
        return typeof (window) !== 'undefined';
    }
}
NgGoTopButtonComponent.decorators = [
    { type: Component, args: [{
                selector: 'ng-go-top-button',
                template: `
    <button type="button" aria-label="go to top of page"
            [tabIndex]="tabIndex"
            [@appearInOut]="animationState"
            (click)="scrollTop($event)"
            [ngStyle]="getStyle()"
            [ngClass]="classNames">
      <ng-content></ng-content>
    </button>`,
                encapsulation: ViewEncapsulation.None,
                animations: [
                    trigger('appearInOut', [
                        state('in', style({
                            opacity: '0.85'
                        })),
                        state('out', style({
                            opacity: '0'
                        })),
                        transition('in => out', animate('400ms ease-in-out')),
                        transition('out => in', animate('400ms ease-in-out'))
                    ]),
                ],
                styles: [`.go-top-button {
      position: fixed;
      cursor: pointer;
      outline: none;
      top: 50%;
      bottom: 50%;
      right: 0;
      width: 35px;
      height: 35px;
      line-height: 35px;
      text-decoration: none;
      color: #ffffff;
      background: rgba(0, 0, 0, 0.3);
      border: none;
      border-radius: 3px 0 0 3px;
    }

    .go-top-button:hover, .go-top-button:focus {
      background-color: rgba(0, 0, 0, 0.6);
      text-decoration: none;
      color: white;
    }`]
            },] }
];
NgGoTopButtonComponent.propDecorators = {
    scrollDistance: [{ type: Input }],
    styles: [{ type: Input }],
    classNames: [{ type: Input }],
    animate: [{ type: Input }],
    speed: [{ type: Input }],
    acceleration: [{ type: Input }],
    tabIndex: [{ type: Input }],
    onWindowScroll: [{ type: HostListener, args: ['window:scroll', [],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZ28tdG9wLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvYW5uYS9kZXYvbmctZ28tdG9wLWJ1dHRvbi9wcm9qZWN0cy9uZy1nby10b3AtYnV0dG9uL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9uZy1nby10b3AtYnV0dG9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsaUJBQWlCLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDeEYsT0FBTyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQW9EL0U7O0dBRUc7QUFDSCxNQUFNLE9BQU8sc0JBQXNCO0lBckRuQztRQXNERSxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUNmLFlBQU8sR0FBUSxJQUFJLENBQUM7UUFFNUI7O1dBRUc7UUFDTSxtQkFBYyxHQUFHLEdBQUcsQ0FBQztRQUU5Qjs7V0FFRztRQUNNLFdBQU0sR0FBUSxFQUFFLENBQUM7UUFFMUI7O1dBRUc7UUFDTSxlQUFVLEdBQUcsZUFBZSxDQUFDO1FBRXRDOztXQUVHO1FBQ00sWUFBTyxHQUFHLEtBQUssQ0FBQztRQUV6Qjs7V0FFRztRQUNNLFVBQUssR0FBRyxFQUFFLENBQUM7UUFFcEI7O1dBRUc7UUFDTSxpQkFBWSxHQUFHLENBQUMsQ0FBQztRQUUxQjs7V0FFRztRQUNNLGFBQVEsR0FBRyxDQUFDLENBQUM7SUE2R3hCLENBQUM7SUEzR0MsUUFBUTtRQUNOLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRU8sY0FBYztRQUNwQixNQUFNLGtCQUFrQixHQUFHLGdEQUFnRCxDQUFDO1FBRTVFLElBQUksSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLEVBQUU7WUFDM0IsTUFBTSxLQUFLLENBQUMsa0JBQWtCLEdBQUcsNERBQTRE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SSxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVM7UUFDUCxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxXQUFXLENBQUM7SUFDekMsQ0FBQzs7O1lBdE1GLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsa0JBQWtCO2dCQUM1QixRQUFRLEVBQUU7Ozs7Ozs7O2NBUUU7Z0JBQ1osYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7Z0JBeUJyQyxVQUFVLEVBQUU7b0JBQ1YsT0FBTyxDQUFDLGFBQWEsRUFBRTt3QkFDckIsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUM7NEJBQ2hCLE9BQU8sRUFBRSxNQUFNO3lCQUNoQixDQUFDLENBQUM7d0JBQ0gsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7NEJBQ2pCLE9BQU8sRUFBRSxHQUFHO3lCQUNiLENBQUMsQ0FBQzt3QkFDSCxVQUFVLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO3dCQUNyRCxVQUFVLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO3FCQUN0RCxDQUFDO2lCQUNIO3lCQWxDRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O01BcUJBO2FBY0w7Ozs2QkFZRSxLQUFLO3FCQUtMLEtBQUs7eUJBS0wsS0FBSztzQkFLTCxLQUFLO29CQUtMLEtBQUs7MkJBS0wsS0FBSzt1QkFLTCxLQUFLOzZCQTZCTCxZQUFZLFNBQUMsZUFBZSxFQUFFLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgSG9zdExpc3RlbmVyLCBJbnB1dCwgT25Jbml0LCBWaWV3RW5jYXBzdWxhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge3RyaWdnZXIsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgYW5pbWF0ZX0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nLWdvLXRvcC1idXR0b24nLCAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lXG4gIHRlbXBsYXRlOiBgXG4gICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgYXJpYS1sYWJlbD1cImdvIHRvIHRvcCBvZiBwYWdlXCJcbiAgICAgICAgICAgIFt0YWJJbmRleF09XCJ0YWJJbmRleFwiXG4gICAgICAgICAgICBbQGFwcGVhckluT3V0XT1cImFuaW1hdGlvblN0YXRlXCJcbiAgICAgICAgICAgIChjbGljayk9XCJzY3JvbGxUb3AoJGV2ZW50KVwiXG4gICAgICAgICAgICBbbmdTdHlsZV09XCJnZXRTdHlsZSgpXCJcbiAgICAgICAgICAgIFtuZ0NsYXNzXT1cImNsYXNzTmFtZXNcIj5cbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICA8L2J1dHRvbj5gLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBzdHlsZXM6IFtcbiAgICAgIGAuZ28tdG9wLWJ1dHRvbiB7XG4gICAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICBvdXRsaW5lOiBub25lO1xuICAgICAgdG9wOiA1MCU7XG4gICAgICBib3R0b206IDUwJTtcbiAgICAgIHJpZ2h0OiAwO1xuICAgICAgd2lkdGg6IDM1cHg7XG4gICAgICBoZWlnaHQ6IDM1cHg7XG4gICAgICBsaW5lLWhlaWdodDogMzVweDtcbiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjMpO1xuICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgYm9yZGVyLXJhZGl1czogM3B4IDAgMCAzcHg7XG4gICAgfVxuXG4gICAgLmdvLXRvcC1idXR0b246aG92ZXIsIC5nby10b3AtYnV0dG9uOmZvY3VzIHtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC42KTtcbiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICB9YFxuICBdLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignYXBwZWFySW5PdXQnLCBbXG4gICAgICBzdGF0ZSgnaW4nLCBzdHlsZSh7XG4gICAgICAgIG9wYWNpdHk6ICcwLjg1J1xuICAgICAgfSkpLFxuICAgICAgc3RhdGUoJ291dCcsIHN0eWxlKHtcbiAgICAgICAgb3BhY2l0eTogJzAnXG4gICAgICB9KSksXG4gICAgICB0cmFuc2l0aW9uKCdpbiA9PiBvdXQnLCBhbmltYXRlKCc0MDBtcyBlYXNlLWluLW91dCcpKSxcbiAgICAgIHRyYW5zaXRpb24oJ291dCA9PiBpbicsIGFuaW1hdGUoJzQwMG1zIGVhc2UtaW4tb3V0JykpXG4gICAgXSksXG4gIF0sXG59KVxuXG4vKipcbiAqIENvbXBvbmVudCBmb3IgYWRkaW5nIGEgZ28tdG8tdG9wIGJ1dHRvbiB0byBzY3JvbGxhYmxlIGJyb3dzZXIgY29udGVudFxuICovXG5leHBvcnQgY2xhc3MgTmdHb1RvcEJ1dHRvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIGFuaW1hdGlvblN0YXRlID0gJ291dCc7XG4gIHByaXZhdGUgdGltZXJJRDogYW55ID0gbnVsbDtcblxuICAvKipcbiAgICogR28gdG9wIGJ1dHRvbiB3aWxsIGFwcGVhciB3aGVuIHVzZXIgc2Nyb2xscyBZIHRvIHRoaXMgcG9zaXRpb25cbiAgICovXG4gIEBJbnB1dCgpIHNjcm9sbERpc3RhbmNlID0gMjAwO1xuXG4gIC8qKlxuICAgKiBVc2VyIHN0eWxlcyBjb25maWcgb2JqZWN0XG4gICAqL1xuICBASW5wdXQoKSBzdHlsZXM6IGFueSA9IHt9O1xuXG4gIC8qKlxuICAgKiBDbGFzc2VzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGJ1dHRvblxuICAgKi9cbiAgQElucHV0KCkgY2xhc3NOYW1lcyA9ICdnby10b3AtYnV0dG9uJztcblxuICAvKipcbiAgICogSWYgdHJ1ZSBzY3JvbGxpbmcgdG8gdG9wIHdpbGwgYmUgYW5pbWF0ZWRcbiAgICovXG4gIEBJbnB1dCgpIGFuaW1hdGUgPSBmYWxzZTtcblxuICAvKipcbiAgICogQW5pbWF0ZWQgc2Nyb2xsaW5nIHNwZWVkXG4gICAqL1xuICBASW5wdXQoKSBzcGVlZCA9IDgwO1xuXG4gIC8qKlxuICAgKiBBY2NlbGVyYXRpb24gY29lZmZpY2llbnQsIGFkZGVkIHRvIHNwZWVkIHdoZW4gdXNpbmcgYW5pbWF0ZWQgc2Nyb2xsXG4gICAqL1xuICBASW5wdXQoKSBhY2NlbGVyYXRpb24gPSAwO1xuXG4gIC8qKlxuICAgKiBCdXR0b24gdGFiSW5kZXggSFRNTCBhdHRyaWJ1dGVcbiAgICovXG4gIEBJbnB1dCgpIHRhYkluZGV4ID0gMDtcblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnZhbGlkYXRlSW5wdXRzKCk7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlSW5wdXRzKCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZVByZWZpeCA9ICdHb1RvcEJ1dHRvbiBjb21wb25lbnQgaW5wdXQgdmFsaWRhdGlvbiBlcnJvcjogJztcblxuICAgIGlmICh0aGlzLnNjcm9sbERpc3RhbmNlIDwgMCkge1xuICAgICAgdGhyb3cgRXJyb3IoZXJyb3JNZXNzYWdlUHJlZml4ICsgJ1xcJ3Njcm9sbERpc3RhbmNlXFwnIHBhcmFtZXRlciBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gMCcpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNwZWVkIDwgMSkge1xuICAgICAgdGhyb3cgRXJyb3IoZXJyb3JNZXNzYWdlUHJlZml4ICsgJ1xcJ3NwZWVkXFwnIHBhcmFtZXRlciBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYWNjZWxlcmF0aW9uIDwgMCkge1xuICAgICAgdGhyb3cgRXJyb3IoZXJyb3JNZXNzYWdlUHJlZml4ICsgJ1xcJ2FjY2VsZXJhdGlvblxcJyBwYXJhbWV0ZXIgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIDAnKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuY2xhc3NOYW1lcyAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IEVycm9yKGVycm9yTWVzc2FnZVByZWZpeCArICdcXCdjbGFzc05hbWVzXFwnIHBhcmFtZXRlciBtdXN0IGJlIGEgc3RyaW5nIGxpa2UgXFwnY2xhc3MxIGNsYXNzMiBjbGFzczNcXCcnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdGVucyB0byB3aW5kb3cgc2Nyb2xsIGFuZCBhbmltYXRlcyB0aGUgYnV0dG9uXG4gICAqL1xuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6c2Nyb2xsJywgW10pXG4gIG9uV2luZG93U2Nyb2xsKCkge1xuICAgIGlmICh0aGlzLmlzQnJvd3NlcigpKSB7XG4gICAgICB0aGlzLmFuaW1hdGlvblN0YXRlID0gdGhpcy5nZXRDdXJyZW50U2Nyb2xsVG9wKCkgPiB0aGlzLnNjcm9sbERpc3RhbmNlID8gJ2luJyA6ICdvdXQnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTY3JvbGxzIHdpbmRvdyB0byB0b3BcbiAgICovXG4gIHNjcm9sbFRvcChldmVudDogYW55KSB7XG4gICAgaWYgKCF0aGlzLmlzQnJvd3NlcigpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAodGhpcy5hbmltYXRlKSB7XG4gICAgICB0aGlzLmFuaW1hdGVTY3JvbGxUb3AoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtcyB0aGUgYW5pbWF0ZWQgc2Nyb2xsIHRvIHRvcFxuICAgKi9cbiAgYW5pbWF0ZVNjcm9sbFRvcCgpIHtcbiAgICBpZiAodGhpcy50aW1lcklEICE9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGluaXRpYWxTcGVlZCA9IHRoaXMuc3BlZWQ7XG5cbiAgICB0aGlzLnRpbWVySUQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB3aW5kb3cuc2Nyb2xsQnkoMCwgLWluaXRpYWxTcGVlZCk7XG4gICAgICBpbml0aWFsU3BlZWQgPSBpbml0aWFsU3BlZWQgKyB0aGlzLmFjY2VsZXJhdGlvbjtcbiAgICAgIGlmICh0aGlzLmdldEN1cnJlbnRTY3JvbGxUb3AoKSA9PT0gMCkge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXJJRCk7XG4gICAgICAgIHRoaXMudGltZXJJRCA9IG51bGw7XG4gICAgICB9XG4gICAgfSwgMTUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IFkgc2Nyb2xsIHBvc2l0aW9uXG4gICAqL1xuICBnZXRDdXJyZW50U2Nyb2xsVG9wKCkge1xuICAgIGlmICh0eXBlb2Ygd2luZG93LnNjcm9sbFkgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5zY3JvbGxZID49IDApIHtcbiAgICAgIHJldHVybiB3aW5kb3cuc2Nyb2xsWTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdy5wYWdlWU9mZnNldCAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LnBhZ2VZT2Zmc2V0ID49IDApIHtcbiAgICAgIHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCAhPT0gJ3VuZGVmaW5lZCcgJiYgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPj0gMCkge1xuICAgICAgcmV0dXJuIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCAhPT0gJ3VuZGVmaW5lZCcgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA+PSAwKSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYnV0dG9uIHN0eWxlXG4gICAqL1xuICBnZXRTdHlsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zdHlsZXMgfHwge307XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBjaGVjayB3aWxsIHByZXZlbnQgJ3dpbmRvdycgbG9naWMgdG8gYmUgZXhlY3V0ZWRcbiAgICogd2hpbGUgZXhlY3V0aW5nIHRoZSBzZXJ2ZXIgcmVuZGVyaW5nXG4gICAqL1xuICBpc0Jyb3dzZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHR5cGVvZiAod2luZG93KSAhPT0gJ3VuZGVmaW5lZCc7XG4gIH1cbn1cbiJdfQ==